# 购买流程与支付功能测试指南

## 功能概述
本购物网站实现了完整的购买流程，包括：
1. 浏览/查询产品
2. 添加至购物车
3. 确认订单并填写收货信息
4. 选择支付方式并提交订单
5. 系统发送订单确认邮件
6. 管理员更新订单状态
7. 系统发送发货通知邮件

## 测试环境准备

### 1. 后端服务
确保后端服务已启动：
```bash
# 进入后端目录
cd backend

# 安装依赖
npm install

# 启动服务
npm start
```

### 2. 数据库
确保MySQL数据库已启动，并且已创建必要的数据库和表：
```bash
# 创建数据库（如果尚未创建）
CREATE DATABASE shoppingweb;

# 导入数据库结构和初始数据
mysql -u root -p shoppingweb < database.sql
```

### 3. 邮件配置
确保 `.env` 文件中的邮件配置正确。以下是几个常用邮件服务的配置示例：

#### Gmail配置（需要开启两步验证并创建应用密码）
```env
# SMTP邮件服务器配置 - Gmail
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
```

#### QQ邮箱配置（需要开启SMTP服务并获取授权码）
```env
# SMTP邮件服务器配置 - QQ邮箱
EMAIL_HOST=smtp.qq.com
EMAIL_PORT=587
EMAIL_USER=your-email@qq.com
EMAIL_PASS=your-authorization-code
```

#### 163邮箱配置（需要开启SMTP服务并设置客户端授权密码）
```env
# SMTP邮件服务器配置 - 163邮箱
EMAIL_HOST=smtp.163.com
EMAIL_PORT=587
EMAIL_USER=your-email@163.com
EMAIL_PASS=your-client-password
```

**重要提示：** 请确保使用真实的邮箱地址和密码/授权码，否则邮件发送功能将无法正常工作。

## 测试步骤

### 1. 用户注册与登录
1. 访问 `http://localhost:3000/register.html` 注册新用户
2. 访问 `http://localhost:3000/login.html` 登录用户账号

### 2. 浏览产品与添加购物车
1. 访问首页 `http://localhost:3000/index.html`
2. 浏览产品列表，选择一个产品
3. 点击「加入购物车」按钮
4. 点击右上角的购物车图标查看购物车

### 3. 确认订单
1. 在购物车页面 `http://localhost:3000/cart.html` 查看商品
2. 调整商品数量或删除不需要的商品
3. 点击「去结账」按钮

### 4. 填写收货信息与选择支付方式
1. 在结账页面填写收货地址
2. 选择支付方式（支付宝/微信支付/银行卡）
3. 点击「提交订单」按钮

### 5. 检查订单创建
1. 订单提交后，系统会显示订单创建成功的提示
2. 访问「我的订单」页面 `http://localhost:3000/orders.html` 查看新创建的订单
3. 订单状态应该为「待处理」

### 6. 管理员操作
1. 管理员登录 `http://localhost:3000/admin.html`（邮箱：admin@example.com，密码：admin123）
2. 点击「订单管理」进入订单管理页面
3. 找到刚才创建的订单，将状态更新为「已发货」

### 7. 检查邮件通知
1. 检查用户邮箱，应该收到两封邮件：
   - 订单确认邮件（提交订单后）
   - 发货通知邮件（管理员更新订单状态后）

## 自动化测试

### 使用前端测试页面
1. 访问 `http://localhost:3000/test-purchase-flow.html`
2. 按照页面上的测试步骤进行测试
3. 页面会显示测试日志，记录每一步的执行结果

### 使用后端测试脚本
1. 进入后端目录
2. 运行测试脚本：
```bash
node test-payment-email.js
```
3. 脚本会测试以下功能：
   - 邮件发送功能
   - 支付集成
   - 订单创建流程
   - 管理员订单管理功能

## 测试用例

### 1. 正常购买流程测试
- **测试目的**：验证完整购买流程是否正常工作
- **测试步骤**：
  1. 用户登录
  2. 添加商品到购物车
  3. 填写收货信息并提交订单
  4. 管理员更新订单状态为已发货
- **预期结果**：
  - 订单创建成功
  - 用户收到订单确认邮件
  - 用户收到发货通知邮件

### 2. 购物车管理测试
- **测试目的**：验证购物车添加、更新、删除功能
- **测试步骤**：
  1. 添加多个商品到购物车
  2. 更新商品数量
  3. 删除商品
  4. 清空购物车
- **预期结果**：
  - 商品成功添加到购物车
  - 数量更新正确
  - 商品可以删除
  - 购物车可以清空

### 3. 订单状态更新测试
- **测试目的**：验证订单状态更新功能
- **测试步骤**：
  1. 创建订单
  2. 管理员将状态更新为「处理中」
  3. 管理员将状态更新为「已发货」
  4. 管理员将状态更新为「已送达」
- **预期结果**：
  - 订单状态更新正确
  - 用户收到相应的邮件通知

### 4. 支付方式测试
- **测试目的**：验证各种支付方式是否正常工作
- **测试步骤**：
  1. 创建订单，选择支付宝支付
  2. 创建订单，选择微信支付
  3. 创建订单，选择银行卡支付
- **预期结果**：
  - 所有支付方式都能成功提交订单

## 常见问题与解决方案

### 1. 邮件发送失败
- **可能原因**：
  - 邮件服务器配置错误
  - 网络连接问题
  - 邮件被拦截或标记为垃圾邮件
- **解决方案**：
  - 检查 `.env` 文件中的邮件配置
  - 确保网络连接正常
  - 检查垃圾邮件文件夹

### 2. 订单创建失败
- **可能原因**：
  - 购物车为空
  - 商品库存不足
  - 用户未登录
  - 数据验证失败
- **解决方案**：
  - 确保购物车中有商品
  - 检查商品库存
  - 确保用户已登录
  - 检查表单填写是否正确

### 3. 支付失败
- **可能原因**：
  - 支付方式不支持
  - 支付信息错误
  - 支付服务不可用
- **解决方案**：
  - 选择其他支付方式
  - 检查支付信息
  - 稍后重试

## 测试结果记录

| 测试功能 | 测试日期 | 测试人员 | 测试结果 | 备注 |
|---------|---------|---------|---------|------|
| 注册登录 | YYYY-MM-DD | XXX | 通过/失败 | |
| 产品浏览 | YYYY-MM-DD | XXX | 通过/失败 | |
| 添加购物车 | YYYY-MM-DD | XXX | 通过/失败 | |
| 订单确认 | YYYY-MM-DD | XXX | 通过/失败 | |
| 支付功能 | YYYY-MM-DD | XXX | 通过/失败 | |
| 邮件通知 | YYYY-MM-DD | XXX | 通过/失败 | |
| 订单管理 | YYYY-MM-DD | XXX | 通过/失败 | |

## 总结
通过以上测试，可以验证购物网站的购买流程和支付功能是否正常工作。如果所有测试用例都通过，则说明系统功能完整可用。如果有测试用例失败，需要根据错误信息进行修复并重新测试。

---

**注意**：在实际生产环境中，建议使用专业的测试工具（如Postman、Selenium等）进行更全面的测试，并考虑安全性、性能等方面的测试。
